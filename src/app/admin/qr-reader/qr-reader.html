<div class="flex flex-col items-center justify-center min-h-screen bg-gradient-to-b from-white via-emerald-50 p-6">

  <!-- Open Camera Button -->
  @if (!scanned) {
    <button
      (click)="startCamera()"
      class="mb-6 w-24 h-24 p-4 text-red-600 rounded-full shadow-lg flex items-center justify-center transition">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z" />
      </svg>
    </button>

  }

  @if (!scanned) {
    <div class="bg-gray-950 rounded-2xl shadow-xl overflow-hidden border border-gray-700 w-full max-w-4xl h-[250px] relative flex justify-center items-center">
      <zxing-scanner
        #scanner
        [device]="currentDevice"
        (scanSuccess)="onCodeResult($event)"
        class="absolute inset-0 w-full h-full object-cover rounded-2xl">
      </zxing-scanner>

      <!-- Corner indicators -->
      <div class="absolute inset-0 pointer-events-none">
        <div class="absolute top-6 left-6 w-16 h-16 border-t-4 border-l-4 border-red-500 rounded-tl-lg"></div>
        <div class="absolute top-6 right-6 w-16 h-16 border-t-4 border-r-4 border-red-500 rounded-tr-lg"></div>
        <div class="absolute bottom-6 left-6 w-16 h-16 border-b-4 border-l-4 border-red-500 rounded-bl-lg"></div>
        <div class="absolute bottom-6 right-6 w-16 h-16 border-b-4 border-r-4 border-red-500 rounded-br-lg"></div>
      </div>

      <!-- Scan line -->
      <div class="absolute inset-0 flex justify-center items-center pointer-events-none">
        <div class="w-4/5 h-2 bg-gradient-to-r from-transparent via-red-800 to-transparent rounded-full animate-pulse-slow"></div>
      </div>

      <!-- Bottom label -->
      <div class="absolute bottom-4 w-full text-center pointer-events-none">
        <small class="text-red-400 font-semibold animate-pulse-slow tracking-wider">{{ 'scaning' | translate }}</small>
      </div>
    </div>
  }




  <!-- Message Card after scan -->
  @if (scanned) {
    <div class="mt-6 w-72 bg-white shadow-2xl rounded-3xl p-6 text-center flex flex-col items-center gap-4 animate-fade-in">
      <div class="max-w-md mx-auto p-6 bg-white rounded-2xl text-center relative overflow-hidden">

        <!-- Confetti / optional animation trigger -->
        <div class="cursor-pointer">

          <!-- Celebration Icon -->
          @if(successMessage){
            <div class="flex justify-center mb-4" >
              <svg class="w-16 h-16 text-yellow-400 animate-pulse" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 1l2.39 4.85L18 7l-4 3.89L15 17l-5-2.63L5 17l1-6.11L2 7l5.61-.15L10 1z"/>
              </svg>
            </div>

          }


          <!-- Conditional Header -->
          <h2 class="text-2xl font-extrabold mb-2"
              [ngClass]="successMessage ? 'text-gray-800' : 'text-red-600'">
            {{ successMessage ? ('Congratulations!' | translate) : ('Oops!' | translate) }}
          </h2>

          <!-- Dynamic Server Message -->
          <p class="text-lg font-semibold transition-all duration-500"
             [ngClass]="successMessage ? 'text-green-600' : 'text-red-600'">
            {{ serverMessage |translate }}
          </p>

          @if (successMessage){
          <div >
            <p class="mt-4 text-gray-600">
              {{ 'Client unlocked a special' | translate }}
              <span class="font-bold text-green-500">% {{ 'discount' | translate }}</span>! ğŸ›ï¸
            </p>
          </div>

          }
        </div>

      </div>

      <button
        (click)="startCamera()"
        class="flex justify-center gap-3 px-6 py-2 bg-blue-600 text-white rounded-3xl shadow-lg hover:bg-blue-700 transition mt-2">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
        </svg>
    {{'scan-again'|translate}}
      </button>
    </div>
  }

</div>
